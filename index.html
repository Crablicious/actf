<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>avis</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="d3-flamegraph.css">
    <link rel="icon" href="favicon.ico" />
  </head>
  <body>
    <nav>
      <a href="index.html">avis</a> |
      <a href="about.html">about</a> |
      <a href="docs/index.html">docs</a>
    </nav>
    <!-- <marquee direction="right"><b>UNDER CONSTRUCTION</b></marquee> -->
    <h1>avis</h1>
    <p>avis is a <a href="https://diamon.org/ctf/">CTF2</a> trace analyzer for file system based CTF2 traces</p>
    <p>It is written to showcase actf functionality and performance</p>
    <p>All processing of trace data is done completely in your local
      browser, which is great for data privacy, but does limit the
      size of the trace to somewhat less than 2 GiB</p>
    <p>To load a CTF trace, select the folder that is a direct parent
      of the <i>metadata file</i>; avis makes no attempt to find the
      CTF trace or read multiple CTF traces</p>
    <div>
      <label for="dir-input" class="buttonlabel">Choose a CTF2 trace to load</label>
      <input type="file" id="dir-input" autocomplete="off" webkitdirectory>
      <button type="button" id="example-input-button">Load an example trace</button>
    </div>
    <div id="trace-info-container">
      <i><p id="trace-info-status">no trace loaded</p></i>
      <div id="trace-info-attributes"></div>
    </div>
    <hr />
    <div>
      <p>Calculate the event distribution, this will loop over all events only looking at their name</p>
      <button type="button" id="run-event-types-button" disabled>Count events</button>
      <img src="loading.gif" id="event-types-loading-img" height="40" style="vertical-align: bottom; visibility: hidden;"/>
      <p id="run-event-types-err" class="run-err"></p>
      <div>
        <canvas id="event-chart" style="display: none; height: 80px;"></canvas>
      </div>
    </div>
    <hr />
    <div>
      <p>Perform call stack related analyses.</p>

      <p>The analyses are based on an trace structure with <i>entry
	events</i>, indicating the start of something, and <i>exit
	events</i>, indicating the end of something. The entry events
	are matched to exit events by the <i>label</i>. The events are
	split up by the <i>track</i> into different call stacks.</p>

      <p>A typical example would be a trace collected by function
      tracing with <q>-finstrument-functions</q>
      and <a href="https://lttng.org/man/3/lttng-ust-cyg-profile/">lttng-ust-cyg-profile</a>.
      For such a trace, the entry event would
      be <q>lttng_ust_cyg_profile:func_entry</q>, the exit event would
      be <q>lttng_ust_cyg_profile:func_exit</q>, the tracks would be
      set to <q>/common-context/_vtid</q> (per thread) and the label
      would be set to <q>/payload/func_addr</q>.</p>
      </p>
      <p></p>
      <table id="callstack-params" style="border-collapse: collapse;">
        <thead>
          <tr>
            <th colspan="2">Entry Event</th>
            <th colspan="2">Exit Event</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><label for="entry-select" title="The entry event name to match">Name:</label></td>
            <td><select id="entry-select" disabled onChange="updateEntryFieldOptions(this.value);"><option hidden disabled selected value> -- select entry event -- </option></select></td>
            <td><label for="exit-select" title="The exit event name to match">Name:</label></td>
            <td><select id="exit-select" disabled onChange="updateExitFieldOptions(this.value);"><option hidden disabled selected value> -- select exit event -- </option></select></td>
          </tr>
          <tr>
            <td><label for="entry-track-select" size="34" title="/path/to/field">Track:</label></td>
            <td><select id="entry-track-select" disabled onChange="updateCallstackButtons();"><option hidden disabled selected value> -- select track field -- </option></select></td>
            <td><label for="exit-track-select" size="34" title="/path/to/field">Track:</label></td>
            <td><select id="exit-track-select" disabled onChange="updateCallstackButtons();"><option hidden disabled selected value> -- select track field -- </option></select></td>
          </tr>
          <tr>
            <td><label for="entry-label-select" title="/path/to/field">Label:</label></td>
            <td><select id="entry-label-select" disabled onChange="updateCallstackButtons();"><option hidden disabled selected value> -- select label field -- </option></select></td>
            <td><label for="exit-label-select" title="/path/to/field">Label:</label></td>
            <td><select id="exit-label-select" disabled onChange="updateCallstackButtons();"><option hidden disabled selected value> -- select label field -- </option></select></td>
          </tr>
        </tbody>
      </table>
      <button type="button" id="run-callstack-stats-button" disabled>Call stack stats</button>
      <img src="loading.gif" id="callstack-stats-loading-img" height="40" style="vertical-align: bottom; visibility: hidden;"/>
      <button type="button" id="run-flamegraph-button" disabled>Flamegraph</button>
      <img src="loading.gif" id="flamegraph-loading-img" height="40" style="vertical-align: bottom; visibility: hidden;"/>
      <p id="run-callstack-stats-err" class="run-err"></p>
      <div id="callstack-stats-container"></div>
      <p id="run-flamegraph-err" class="run-err"></p>
      <div id="flamegraph-container"></div>
    </div>

    <hr />
    <footer>
      <p><i>avis by crablicious on github. powered by actf and json-c, see <a href="about.html">about</a> for details.</i></p>
    </footer>
    <script src="action.js"></script>
    <script src="avis.js"></script>
    <script src="d3.v7.js"></script>
    <script src="d3-flamegraph.min.js"></script>
    <script src="chart.umd.min.js"></script>
  </body>
</html>
